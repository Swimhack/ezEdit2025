openapi: 3.0.3
info:
  title: EzEdit.co Secure File Transfer API - 2025 Standards
  description: SFTP/FTPS file operations API with enhanced security and FTP deprecation
  version: 2025.1.0
  contact:
    name: EzEdit.co Infrastructure Team
    email: infrastructure@ezedit.co

servers:
  - url: https://ezedit.co/api
    description: Production server
  - url: https://staging.ezedit.co/api
    description: Staging server

paths:
  /sftp/connections:
    post:
      summary: Create secure file transfer connection
      description: Establish SFTP or FTPS connection with enhanced security validation
      tags:
        - SFTP Connections
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecureConnectionRequest'
      responses:
        '201':
          description: Secure connection established
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionResponse'
        '400':
          description: Invalid configuration or deprecated protocol
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProtocolDeprecationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Protocol blocked by security policy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityPolicyError'

    get:
      summary: List secure connections
      description: Retrieve all active secure file transfer connections
      tags:
        - SFTP Connections
      security:
        - BearerAuth: []
      parameters:
        - name: protocol
          in: query
          schema:
            type: string
            enum: [sftp, ftps]
          description: Filter by protocol type
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, error]
          description: Filter by connection status
      responses:
        '200':
          description: Connections retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConnectionSummary'

  /sftp/connections/{connectionId}/validate:
    post:
      summary: Validate connection security
      description: Perform comprehensive security validation of SFTP/FTPS connection
      tags:
        - SFTP Security
      security:
        - BearerAuth: []
      parameters:
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Security validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityValidationResult'
        '404':
          description: Connection not found

  /sftp/connections/{connectionId}/files:
    get:
      summary: List files via secure connection
      description: Browse directory contents using SFTP/FTPS with security validation
      tags:
        - File Operations
      security:
        - BearerAuth: []
      parameters:
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
        - name: path
          in: query
          schema:
            type: string
            default: "/"
          description: Directory path to list
        - name: includeHidden
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Directory listing retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DirectoryListing'
        '403':
          description: Access denied or path blocked by security policy
        '404':
          description: Connection or path not found

  /sftp/connections/{connectionId}/files/{filePath}:
    get:
      summary: Read file via secure connection
      description: Download file content using SFTP/FTPS with integrity verification
      tags:
        - File Operations
      security:
        - BearerAuth: []
      parameters:
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
        - name: filePath
          in: path
          required: true
          schema:
            type: string
        - name: encoding
          in: query
          schema:
            type: string
            enum: [utf8, base64, binary]
            default: utf8
      responses:
        '200':
          description: File content retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileContent'
        '403':
          description: File access denied by security policy
        '404':
          description: File not found

    put:
      summary: Write file via secure connection
      description: Upload/update file using SFTP/FTPS with automatic backup
      tags:
        - File Operations
      security:
        - BearerAuth: []
      parameters:
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
        - name: filePath
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileWriteRequest'
      responses:
        '200':
          description: File updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileOperationResult'
        '201':
          description: File created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileOperationResult'
        '403':
          description: Write operation denied by security policy
        '507':
          description: Insufficient storage space

  /sftp/backup/policies:
    get:
      summary: Get backup policies
      description: Retrieve 3-2-1-1-0 backup policies and their status
      tags:
        - Backup Management
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Backup policies retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BackupPolicy'

    post:
      summary: Create backup policy
      description: Create new 3-2-1-1-0 backup policy with GDPR compliance
      tags:
        - Backup Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BackupPolicyRequest'
      responses:
        '201':
          description: Backup policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupPolicy'

  /sftp/backup/execute:
    post:
      summary: Execute manual backup
      description: Trigger immediate backup using 3-2-1-1-0 strategy
      tags:
        - Backup Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - connectionId
                - backupType
              properties:
                connectionId:
                  type: string
                backupType:
                  type: string
                  enum: [full, incremental, differential]
                paths:
                  type: array
                  items:
                    type: string
                  description: Specific paths to backup (optional)
      responses:
        '202':
          description: Backup job initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupJobStatus'

  /sftp/security/assessment:
    post:
      summary: Perform security assessment
      description: Comprehensive security assessment of connection and protocols
      tags:
        - Security Assessment
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - connectionId
              properties:
                connectionId:
                  type: string
                assessmentType:
                  type: string
                  enum: [basic, comprehensive, compliance]
                  default: basic
      responses:
        '200':
          description: Security assessment completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityAssessmentResult'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    SecureConnectionRequest:
      type: object
      required:
        - name
        - host
        - protocol
        - credentials
      properties:
        name:
          type: string
          example: Production Server
        host:
          type: string
          example: secure.example.com
        port:
          type: integer
          example: 22
        protocol:
          type: string
          enum: [sftp, ftps]
          description: Only secure protocols allowed - FTP deprecated
        credentials:
          oneOf:
            - $ref: '#/components/schemas/PasswordCredentials'
            - $ref: '#/components/schemas/KeyCredentials'
            - $ref: '#/components/schemas/CertificateCredentials'
        securitySettings:
          $ref: '#/components/schemas/SecuritySettings'
        timeout:
          type: integer
          minimum: 5000
          maximum: 60000
          default: 30000

    PasswordCredentials:
      type: object
      required:
        - type
        - username
        - password
      properties:
        type:
          type: string
          enum: [password]
        username:
          type: string
        password:
          type: string
          format: password

    KeyCredentials:
      type: object
      required:
        - type
        - username
        - privateKey
      properties:
        type:
          type: string
          enum: [private-key]
        username:
          type: string
        privateKey:
          type: string
          description: Base64 encoded private key
        passphrase:
          type: string
          description: Private key passphrase if encrypted

    CertificateCredentials:
      type: object
      required:
        - type
        - username
        - certificate
        - privateKey
      properties:
        type:
          type: string
          enum: [certificate]
        username:
          type: string
        certificate:
          type: string
          description: Base64 encoded certificate
        privateKey:
          type: string
          description: Base64 encoded private key

    SecuritySettings:
      type: object
      properties:
        requireEncryption:
          type: boolean
          default: true
        cipherSuites:
          type: array
          items:
            type: string
          example: ["aes256-gcm", "aes256-ctr"]
        keyExchangeAlgorithms:
          type: array
          items:
            type: string
          example: ["ecdh-sha2-nistp256", "ecdh-sha2-nistp384"]
        hostKeyVerification:
          type: boolean
          default: true
        allowSelfSignedCertificates:
          type: boolean
          default: false
        minTlsVersion:
          type: string
          enum: ["1.2", "1.3"]
          default: "1.2"

    ConnectionResponse:
      type: object
      properties:
        connectionId:
          type: string
        status:
          type: string
          enum: [connected, error]
        protocol:
          type: string
        securityValidation:
          $ref: '#/components/schemas/SecurityValidationSummary'
        capabilities:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time

    ConnectionSummary:
      type: object
      properties:
        connectionId:
          type: string
        name:
          type: string
        host:
          type: string
        protocol:
          type: string
        status:
          type: string
        lastConnected:
          type: string
          format: date-time
        securityScore:
          type: integer
          minimum: 0
          maximum: 100

    SecurityValidationResult:
      type: object
      properties:
        overallScore:
          type: integer
          minimum: 0
          maximum: 100
        encryption:
          type: object
          properties:
            algorithm:
              type: string
            keyLength:
              type: integer
            strength:
              type: string
              enum: [weak, medium, strong]
        authentication:
          type: object
          properties:
            method:
              type: string
            strength:
              type: string
              enum: [weak, medium, strong]
        compliance:
          type: object
          properties:
            pciDss:
              type: boolean
            fips140:
              type: boolean
            nist:
              type: boolean
        vulnerabilities:
          type: array
          items:
            type: object
            properties:
              severity:
                type: string
                enum: [low, medium, high, critical]
              description:
                type: string
              recommendation:
                type: string
        lastValidated:
          type: string
          format: date-time

    SecurityValidationSummary:
      type: object
      properties:
        passed:
          type: boolean
        score:
          type: integer
        warnings:
          type: array
          items:
            type: string

    DirectoryListing:
      type: object
      properties:
        path:
          type: string
        files:
          type: array
          items:
            $ref: '#/components/schemas/FileInfo'
        directories:
          type: array
          items:
            $ref: '#/components/schemas/DirectoryInfo'
        permissions:
          $ref: '#/components/schemas/PathPermissions'

    FileInfo:
      type: object
      properties:
        name:
          type: string
        size:
          type: integer
        lastModified:
          type: string
          format: date-time
        permissions:
          type: string
        mimeType:
          type: string
        isWritable:
          type: boolean
        isExecutable:
          type: boolean

    DirectoryInfo:
      type: object
      properties:
        name:
          type: string
        lastModified:
          type: string
          format: date-time
        permissions:
          type: string
        isWritable:
          type: boolean

    PathPermissions:
      type: object
      properties:
        read:
          type: boolean
        write:
          type: boolean
        execute:
          type: boolean
        delete:
          type: boolean

    FileContent:
      type: object
      properties:
        content:
          type: string
        encoding:
          type: string
        size:
          type: integer
        lastModified:
          type: string
          format: date-time
        checksum:
          type: string
          description: SHA-256 checksum for integrity verification

    FileWriteRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
        encoding:
          type: string
          enum: [utf8, base64]
          default: utf8
        createBackup:
          type: boolean
          default: true
        preserveTimestamp:
          type: boolean
          default: false

    FileOperationResult:
      type: object
      properties:
        success:
          type: boolean
        size:
          type: integer
        checksum:
          type: string
        backupCreated:
          type: boolean
        backupPath:
          type: string
        lastModified:
          type: string
          format: date-time

    BackupPolicy:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        strategy:
          type: string
          enum: ["3-2-1-1-0"]
        schedule:
          type: object
          properties:
            frequency:
              type: string
              enum: [hourly, daily, weekly, monthly]
            time:
              type: string
              pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
        retention:
          type: object
          properties:
            daily:
              type: integer
            weekly:
              type: integer
            monthly:
              type: integer
            yearly:
              type: integer
        status:
          type: string
          enum: [active, inactive, error]
        lastBackup:
          type: string
          format: date-time

    BackupPolicyRequest:
      type: object
      required:
        - name
        - schedule
        - retention
      properties:
        name:
          type: string
        schedule:
          type: object
          required:
            - frequency
          properties:
            frequency:
              type: string
              enum: [hourly, daily, weekly, monthly]
            time:
              type: string
              pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
        retention:
          type: object
          required:
            - daily
          properties:
            daily:
              type: integer
              minimum: 7
            weekly:
              type: integer
              minimum: 4
            monthly:
              type: integer
              minimum: 3
            yearly:
              type: integer
              minimum: 1

    BackupJobStatus:
      type: object
      properties:
        jobId:
          type: string
        status:
          type: string
          enum: [queued, running, completed, failed]
        progress:
          type: integer
          minimum: 0
          maximum: 100
        estimatedCompletion:
          type: string
          format: date-time
        strategy:
          type: string
          enum: ["3-2-1-1-0"]

    SecurityAssessmentResult:
      type: object
      properties:
        assessmentId:
          type: string
        connectionId:
          type: string
        overallScore:
          type: integer
          minimum: 0
          maximum: 100
        protocolSecurity:
          type: object
          properties:
            protocol:
              type: string
            version:
              type: string
            encryption:
              type: string
            score:
              type: integer
        vulnerabilities:
          type: array
          items:
            type: object
            properties:
              severity:
                type: string
                enum: [low, medium, high, critical]
              title:
                type: string
              description:
                type: string
              remediation:
                type: string
        recommendations:
          type: array
          items:
            type: string
        complianceStatus:
          type: object
          properties:
            pciDss:
              type: boolean
            fips140:
              type: boolean
            iso27001:
              type: boolean
        assessedAt:
          type: string
          format: date-time

    ProtocolDeprecationError:
      type: object
      properties:
        error:
          type: string
          example: "protocol_deprecated"
        message:
          type: string
          example: "FTP protocol is deprecated and blocked by security policy"
        deprecatedProtocol:
          type: string
          example: "ftp"
        alternatives:
          type: array
          items:
            type: string
          example: ["sftp", "ftps"]
        migrationGuide:
          type: string
          example: "https://docs.ezedit.co/migration/ftp-to-sftp"
        blockDate:
          type: string
          format: date
          example: "2025-01-01"

    SecurityPolicyError:
      type: object
      properties:
        error:
          type: string
          example: "security_policy_violation"
        message:
          type: string
        violatedPolicy:
          type: string
        requiredSettings:
          type: object
        recommendation:
          type: string

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        code:
          type: string
        timestamp:
          type: string
          format: date-time

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: SFTP Connections
    description: Secure file transfer protocol connections
  - name: File Operations
    description: File and directory operations via secure protocols
  - name: Backup Management
    description: 3-2-1-1-0 backup strategy management
  - name: Security Assessment
    description: Security validation and compliance checking
  - name: SFTP Security
    description: Security configuration and validation